generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// === Enums ===
enum Role {
  APPLICANT
  COMPANY
  ADMIN
}

enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum SkillLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum LanguageLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  NATIVE
}

// === Users ===
model User {
  id            Int          @id @default(autoincrement())
  name          String
  email         String       @unique
  password      String
  phone         String?      
  role          Role         @default(APPLICANT)
  isActive      Boolean      @default(true)
  emailVerified Boolean      @default(false)
  createdAt     DateTime     @default(now())

  // Relations
  profile        Profile?        // one-to-one
  jobs           Job[]           @relation("CompanyJobs")
  applications   Application[]   // one-to-many
}

// === Profile (applicant CV) ===
model Profile {
  id               Int       @id @default(autoincrement())
  user             User      @relation(fields: [userId], references: [id])
  userId           Int       @unique   // واحد لكل User
  title            String?   
  bio              String?   
  education        String?   
  resumeUrl        String?   
  profilePictureUrl String? 
  githubUrl        String?   
  linkedinUrl      String?   
  birthDate        DateTime? 
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  experiences      Experience[]
  skills           Skill[]
  languages        Language[]
  certifications   Certification[]
}

// === Skills ===
model Skill {
  id        Int        @id @default(autoincrement())
  name      String
  level     SkillLevel?
  profile   Profile    @relation(fields: [profileId], references: [id])
  profileId Int
}

// === Experience ===
model Experience {
  id          Int       @id @default(autoincrement())
  company     String
  title       String
  location    String?   
  startDate   DateTime
  endDate     DateTime?
  description String?
  profile     Profile   @relation(fields: [profileId], references: [id])
  profileId   Int
}

// === Languages ===
model Language {
  id        Int          @id @default(autoincrement())
  name      String
  level     LanguageLevel?
  profile   Profile      @relation(fields: [profileId], references: [id])
  profileId Int
}

// === Certifications ===
model Certification {
  id             Int       @id @default(autoincrement())
  name           String
  issuer         String?
  date           DateTime?
  certificateUrl String?  
  profile        Profile   @relation(fields: [profileId], references: [id])
  profileId      Int
}

// === Jobs (posted by companies) ===
model Job {
  id              Int           @id @default(autoincrement())
  title           String
  description     String
  location        String?       
  salaryRange     String?       
  isRemote        Boolean?      
  category        String?       
  experienceLevel String?       
  company         User          @relation(fields: [companyId], references: [id], name: "CompanyJobs")
  companyId       Int
  applications    Application[]
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

// === Applications (job applications) ===
model Application {
  id           Int              @id @default(autoincrement())
  job          Job              @relation(fields: [jobId], references: [id])
  jobId        Int
  applicant    User             @relation(fields: [applicantId], references: [id])
  applicantId  Int
  coverLetter  String?          
  status       ApplicationStatus @default(PENDING)
  interviewDate DateTime?       
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
}

// === Admin Stats ===
model AdminStats {
  id                Int      @id @default(autoincrement())
  totalUsers        Int
  totalCompanies    Int
  totalJobs         Int
  totalApplications Int
  updatedAt         DateTime @updatedAt
}
